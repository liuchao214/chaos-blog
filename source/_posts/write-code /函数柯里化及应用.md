---
title: å‡½æ•°æŸ¯é‡ŒåŒ–åŠåº”ç”¨
date: 2019-09-25 15:03:32
index_img: /images/code.png
banner_img: /images/code-bg.jpg
tags: [JavaScript]
categories: [æ‰‹æ’•ä»£ç ]
---
### å‰è¨€

æˆ‘ä»¬åœ¨å„ç§ç®—æ³•é¢˜ä»¥åŠæŠ€æœ¯æ–‡æ¡£ä¸­ç»å¸¸ä¼šçœ‹åˆ°æŸ¯é‡ŒåŒ–è¿™ä¸ªè¯ï¼Œé‚£ä¹ˆï¼ŒæŸ¯é‡ŒåŒ–åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒåœ¨ js ä¸­å¦‚ä½•è¿ç”¨ï¼Ÿå¯¹æˆ‘ä»¬çš„ç¼–ç¨‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿéƒ½ 9102 å¹´äº†ï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“è¿™äº›ï¼Œé‚£ä¹ˆä½ åœ¨é¢è¯•è¿‡ç¨‹ä¸­å¾ˆå¯èƒ½ä¼šè¢«é¢è¯•å®˜ dissğŸ™„
<!-- more -->
* * *

### ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰

*ç»´åŸºç™¾ç§‘*çš„[è§£é‡Š](https://links.jianshu.com/go?to=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E6%259F%25AF%25E9%2587%258C%25E5%258C%2596)æ˜¯ï¼šæŠŠæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥æ”¶ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶è¿”å›æ¥å—å‰©ä½™çš„å‚æ•°è€Œä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚å…¶ç”±æ•°å­¦å®¶ Haskell Brooks Curry æå‡ºï¼Œå¹¶ä»¥ curry å‘½åã€‚

ç®€å•çš„è¯´ï¼ŒæŸ¯é‡ŒåŒ–å‡½æ•°æŒç»­åœ°è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ç›´åˆ°æ‰€æœ‰çš„å‚æ•°ç”¨å°½ä¸ºæ­¢ã€‚è¿™äº›å‚æ•°å…¨éƒ¨ä¿æŒ â€œæ´»ç€â€ çš„çŠ¶æ€ï¼ˆé€šè¿‡é—­åŒ…ï¼‰ï¼Œç„¶åå½“æŸ¯é‡ŒåŒ–é“¾ä¸­çš„æœ€åä¸€ä¸ªå‡½æ•°è¢«è¿”å›å’Œæ‰§è¡Œæ—¶ä¼šå…¨éƒ¨è¢«ç”¨æ¥æ‰§è¡Œã€‚

è¿™å’Œ[é«˜é˜¶ç»„ä»¶](https://links.jianshu.com/go?to=https%3A%2F%2Freact.docschina.org%2Fdocs%2Fhigher-order-components.html)ï¼ˆHigher-order functionsï¼‰å¦‚å‡ºä¸€è¾™ã€‚å‰è€…è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œåè€…è¿”å›ä¸€ä¸ªæ–°ç»„ä»¶ã€‚

### ä¸¾ä¸ªç®€å•çš„æ —å­

æœ¬ä¾‹ä½¿ç”¨åˆ°çš„éƒ¨åˆ† ES6 çŸ¥è¯†ï¼š[const](https://links.jianshu.com/go?to=http%3A%2F%2Fes6.ruanyifeng.com%2F%23docs%2Flet)ï¼Œ[arrow function](https://links.jianshu.com/go?to=http%3A%2F%2Fes6.ruanyifeng.com%2F%23docs%2Ffunction)ã€‚ä¸äº†è§£çš„åŒå­¦å¯å…ˆè¡ŒæŸ¥çœ‹ã€‚  
å†™ä¸€ä¸ªè®¡ç®—ä¸‰ä¸ªå‚æ•°ç›¸ä¹˜çš„å‡½æ•°ï¼š

```js
function multiply (a, b, c) {
  return a * b * c
}
multiply(1, 2, 3)
```

è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€ååº”å†™å‡ºæ¥çš„ demoï¼Œä¹Ÿæ˜¯çœ‹èµ·æ¥æœ€ç®€å•çš„å®ç°æ–¹æ³•ã€‚å†æ¥åˆ›å»ºä¸€ä¸ªæŸ¯é‡ŒåŒ–ç‰ˆæœ¬çš„å‡½æ•°ï¼š

```js
function multiply (a) {
  return (b) => {
    return (c) => {
      return a * b * c
    }
  }
}
multiply(1)(2)(3)
```

è¿™é‡Œæˆ‘ä»¬å°† multiply(1ï¼Œ2ï¼Œ3) è°ƒç”¨å˜æˆäº† multiply (1) (2) (3) è°ƒç”¨ã€‚  
å•ç‹¬ä¸€ä¸ªå‡½æ•°è¢«è½¬æ¢æˆäº†ä¸€ç³»åˆ—å‡½æ•°ã€‚ä¸ºäº†å¾—åˆ°æ•°å­— 1ã€2ã€3 ç›¸ä¹˜çš„ç»“æœï¼Œè¿™äº›æ•°å­—è¢«ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ä¼ é€’ï¼Œæ¯ä¸ªæ•°å­—é¢„å¡«äº†ä¸‹ä¸€ä¸ªå‡½æ•°å†…è”è°ƒç”¨ã€‚

æˆ‘ä»¬æŠŠ multiply (1) (2) (3) åˆ†å‰²ä¸€ä¸‹æ¥å¸®åŠ©ç†è§£ï¼š

```js
const mul1 = multiply(1)
const mul2 = mul1(2)
const result = mul2(3)
console.log(result)
```

å½“ mul2 ä½¿ç”¨ 3 ä½œä¸ºå‚æ•°è°ƒç”¨æ—¶ï¼Œå®ƒä¸€èµ·ä½¿ç”¨äº†ä¹‹å‰å·²æ‹¿åˆ°çš„å‚æ•° a=1 å’Œ b=2 è¿›è¡Œè¿ç®—å¹¶è¿”å›ç»“æœ 6ã€‚

ä½œä¸ºä¸€ä¸ªåµŒå¥—å‡½æ•°ï¼Œmul2 èƒ½å¤Ÿè®¿é—®åˆ°å¤–éƒ¨çš„ä¸¤ä¸ªå‡½æ•° multiply å’Œ mul1 çš„ä½œç”¨åŸŸã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ mul2 èƒ½åˆ©ç”¨å®šä¹‰åœ¨å·²ç»â€˜ç¦»åœºâ€™çš„å‡½æ•°ä¸­çš„å‚æ•°æ¥è¿›è¡Œä¹˜æ³•æ“ä½œçš„åŸå› ã€‚å³ä½¿è¿™äº›å‡½æ•°æ—©å·²è¿”å›å¹¶ä¸”ä»å†…å­˜ä¸­åƒåœ¾å›æ”¶äº†ï¼Œä½†å…¶å˜é‡ä»ç„¶ä¿æŒâ€˜æ´»ç€â€™([é—­åŒ…](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.liaoxuefeng.com%2Fwiki%2F001434446689867b27157e896e74d51a89c25cc8b43bdb3000%2F00143449934543461c9d5dfeeb848f5b72bd012e1113d15000))ã€‚ä½ å¯ä»¥çœ‹åˆ° 3 ä¸ªæ•°å­—æ¯æ¬¡åªæœ‰ 1 ä¸ªæä¾›ç»™å‡½æ•°ï¼Œå¹¶ä¸”åŒä¸€æ—¶é—´é‡Œä¸€ä¸ªæ–°å‡½æ•°ä¼šè¢«è¿”å›ï¼Œç›´åˆ°æ‰€æœ‰çš„æ•°å­—ç”¨å°½ä¸ºæ­¢ã€‚

**æŸ¯é‡ŒåŒ–èƒŒåçš„é€»è¾‘å°±æ˜¯è·å–ä¸€ä¸ªå‡½æ•°å¹¶æ´¾ç”Ÿå‡ºä¸€ä¸ªè¿”å›ç‰¹æ®Šå‡½æ•°çš„å‡½æ•°**ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ç§æ€æƒ³ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§ç¨‹åºè®¾è®¡æ¨¡å¼ã€‚

### æŸ¯é‡ŒåŒ–çš„åº”ç”¨

#### 1. ç¼–å†™å¯ä»¥è½»æ¾å¤ç”¨å’Œé…ç½®çš„å°ä»£ç å—ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨ npm ä¸€æ ·ï¼š

ä¸¾ä¸ªä¾‹å­ï¼Œä½ æœ‰ä¸€å®¶å•†åº—ï¼Œç„¶åä½ æƒ³ç»™ä½ çš„ä¼˜æƒ é¡¾å®¢ 10% çš„æŠ˜æ‰£ï¼š

```js
function discount (price, discount) {
  return price * discount
}

const price = discount(500, 0.1) 
const price = discount(1500, 0.1) 
const price = discount(2000, 0.1) 
const price = discount(50, 0.1) 
const price = discount(300, 0.1) 

function discount (discount) {
  return (price) => {
    return price * discount
  }
}
const tenPercentDiscount = discount(0.1)

tenPercentDiscount(500) 

const twentyPercentDiscount = discount(0.2)

twentyPercentDiscount(500) 
twentyPercentDiscount(3000) 
twentyPercentDiscount(80000)
```

è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œä½¿ç”¨æŸ¯é‡ŒåŒ–æ€æƒ³èƒ½è®©æˆ‘ä»¬åœ¨é‡åˆ°åªèƒ½ç¡®å®šä¸€ä¸ªå‚æ•°è€Œæ— æ³•ç¡®å®šå¦ä¸€ä¸ªå‚æ•°æ—¶ï¼Œä»£ç è®¾è®¡ç¼–çš„å˜å¾—æ›´æ–¹ä¾¿ä¸é«˜æ•ˆï¼Œè¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„ã€‚

#### 2. é¿å…é¢‘ç¹è°ƒç”¨å…·æœ‰ç›¸åŒå‚æ•°çš„å‡½æ•°ï¼š

æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸ªç”¨æ¥è®¡ç®—ä½“ç§¯çš„å‡½æ•°:

```js
function volume (l, w, h) {
  return l * w * h
}

volume(200, 30, 100) 
volume(32, 45, 100) 
volume(2322, 232, 100) 

function volume (h) {
  return (w) => {
    return (l) => {
      return l * w * h
    }
  }
}

const hCylinderHeight = volume(100)
hCylinderHeight(200)(30) 
hCylinderHeight(2322)(232)
```

### é€šç”¨çš„æŸ¯é‡Œå‡½æ•°

è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå‡½æ•°æ¥æ¥å—ä»»ä½•å‡½æ•°å¹¶ä¸”è¿”å›æŸ¯é‡ŒåŒ–ç‰ˆæœ¬çš„å‡½æ•°ï¼š

```js
function curry (fn, ...args) {
  return (..._args) => {
    return fn(...args, ..._args)
  }
}
```

æˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬çš„ curry å‡½æ•°æ¥å—ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦æŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼ˆfnï¼‰å’Œä¸€ä¸ªå˜é‡ï¼ˆ...argsï¼‰ã€‚è¿™é‡Œçš„ rest æ“ä½œç¬¦ç”¨æ¥å°†å‚æ•°èšé›†æˆä¸€ä¸ª...argsã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å…¶ä½™å‚æ•°æ”¶é›†ä¸º..._argsã€‚æ­¤å‡½æ•°é€šè¿‡ spread è¿ç®—ç¬¦å°†... args å’Œ..._ args ä½œä¸ºå‚æ•°è§£æ„ä¼ å…¥æ¥è°ƒç”¨åŸå§‹å‡½æ•° fnï¼Œç„¶åå°†å€¼è¿”å›ç»™ç”¨æˆ·ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„ curry å‡½æ•°ç”¨ä¹‹å‰çš„ä¾‹å­æ¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼ˆä¸€ä¸ªä¸“é—¨ç”¨æ¥è®¡ç®— 100m é•¿åº¦çš„ç‰©å“ä½“ç§¯ï¼‰ï¼š

```js
function volume (l, h, w) {
  return l * h * w
}
const hCy = curry(volume, 100)
hCy(200, 900) 
hCy(70, 60)
```

å°†ç±»ä¼¼å›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å…¥æŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œèƒ½ä½¿å¤æ‚çš„é—®é¢˜å˜å¾—ç®€å•ï¼

### ä½¿ç”¨é€’å½’å®ç° curry å‡½æ•°

JS æŸ¯é‡ŒåŒ–ä½œä¸ºå‡½æ•°å¼ç¼–ç¨‹çš„é‡è¦ä¸€ç¯ï¼Œé¢‘ç¹åœ¨ç®—æ³•é¢˜ä¸­å‡ºç°ã€‚ä»¥ä¸Šçš„é€šç”¨æŸ¯é‡ŒåŒ–å‡½æ•°è¿˜ä¸å¤Ÿå®Œå–„ï¼Œæˆ‘ä»¬å¸Œæœ›åªç»™ curry å‡½æ•°ä¼ é€’ä¸€ä¸ª fn å°±èƒ½è¾¾åˆ°ç›®çš„ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨é€’å½’æ¥å®ç°ï¼š

```js
function curry(fn) {
  const c = (...args) => (args.length === fn.length) ?
          fn(...args) : (..._args) => c(...args, ..._args)
  return c
}
```

è¯¥æ–¹æ³•å‡ ä¹ä¸ºæœ€ç®€æ´ã€ä»£ç è¡Œæ•°æœ€å°‘çš„å®ç°æ–¹æ³•äº†ã€‚  
é¦–å…ˆæˆ‘ä»¬èƒ½ç¡®å®šï¼Œå®ç°æŸ¯é‡ŒåŒ–çš„æ ¸å¿ƒå°±æ˜¯è¦ç¡®å®šä¼ å…¥å‚æ•°çš„ä¸ªæ•°ï¼Œå¹¶é€šé€šå–åˆ°ã€‚  
å…¶æ¬¡ï¼Œæˆ‘ä»¬å¾—çŸ¥é“ï¼Œ`fn.length`ä¸º fn å‡½æ•°æ¥å—çš„å‚æ•°ä¸ªæ•°ï¼Œé‚£ä¹ˆè¯¥å®ç°æ–¹æ³•å°±èƒ½è§£è¯»ä¸ºï¼š  
**ä¸æ–­é€’å½’è·å–ä¼ å…¥å‚æ•°ï¼Œç›´åˆ°å–åˆ°çš„å‚æ•°ä¸ªæ•°ç­‰äº fn çš„å‚æ•°ä¸ªæ•°ä¸ºæ­¢ï¼Œæœ€ç»ˆå°†è·å–åˆ°çš„æ‰€æœ‰å‚æ•°ä¼ ç»™ fn å¹¶è¿”å›æ‰§è¡Œç»“æœ**ã€‚

### ç»“è¯­

æŸ¯é‡ŒåŒ–ä½œä¸ºä¸€ç§é‡è¦çš„ç¨‹åºæ€æƒ³ï¼Œå·²ç»å¹¿ä¸ºåº”ç”¨ï¼Œå®ƒä½¿æˆ‘ä»¬åº”å¯¹å¤æ‚é—®é¢˜æ—¶èƒ½æå‡æ•ˆç‡ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚å¸Œæœ›è¯»è€…éƒ½èƒ½ä½“ä¼šè¿™ç§æ€æƒ³å¹¶è¿ç”¨äºå®è·µï¼Œç›¸ä¿¡åœ¨æå‡æŠ€æœ¯çš„è·¯ä¸Šèƒ½è¶Šèµ°è¶Šè¿œï¼Œæˆä¸ºä¸€åä¼˜ç§€çš„å·¥ç¨‹å¸ˆï¼

[åŸæ–‡åœ°å€](https://www.jianshu.com/p/7fa99a4bee8b)


### ç”±æµ…å…¥æ·±çš„æŸ¯é‡ŒåŒ–

åœ¨å‰ç«¯é¢è¯•ä¸­æœ‰ä¸€ä¸ªå…³äºæŸ¯é‡ŒåŒ–çš„é¢è¯•é¢˜ï¼Œæµä¼ ç”šå¹¿ã€‚

> å®ç°ä¸€ä¸ªaddæ–¹æ³•ï¼Œä½¿è®¡ç®—ç»“æœèƒ½å¤Ÿæ»¡è¶³å¦‚ä¸‹é¢„æœŸï¼š
> add(1)(2)(3) = 6
> add(1, 2)(3, 4) = 10
> add(1)(2)(3)(4)(5) = 15

```js
function add(...args) {
    // åœ¨å†…éƒ¨å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œåˆ©ç”¨é—­åŒ…çš„ç‰¹æ€§ä¿å­˜argså¹¶æ”¶é›†æ‰€æœ‰çš„å‚æ•°å€¼
    let allArgs = args;
    const adder = () => {
        const setter = (...setterArgs) => {
            allArgs = allArgs.concat([...setterArgs]);
            return setter;
        };
        // åˆ©ç”¨éšå¼è½¬æ¢çš„ç‰¹æ€§ï¼Œå½“æœ€åæ‰§è¡Œæ—¶éšå¼è½¬æ¢ï¼Œå¹¶è®¡ç®—æœ€ç»ˆçš„å€¼è¿”å›
        setter.valueOf = () => {
            return allArgs.reduce((a, b) => {
                return a + b;
            });
        };
        return setter;
    };
    return adder();
}

// è¾“å‡ºç»“æœï¼Œå¯è‡ªç”±ç»„åˆçš„å‚æ•°
console.log(Number(add(1, 2, 3)));  // 6
console.log(Number(add(1, 2)(3, 4)));  // 10
console.log(Number(add(1)(2)(3)(4)(5)));  // 15
```
